# Решение задачи по анализу кредитного потенциала клиентов

## Описание задачи

Даны 3 таблицы:
- `daily_trx` - дневные данные по транзакциям клиента с 2018 года
- `merchant_info` - справочник точек совершения операции
- `cred_potential` - данные о кредитном потенциале клиента

## Требования

1. По каждому клиенту найти количество дней (с начала 2019г. до конца июня 2019г.), которое ему потребовалось, чтобы совершить транзакций (расходных операций) на сумму не меньшую, чем его кредитный потенциал. Если он так и не потратил его, то вывести по клиенту значение = 200

2. Все то же самое, но теперь учитывать только транзакции в подгруппах mcc кодов, в названиях которых содержится слово «снятие»

## Решение

### Логика решения:

1. **Фильтрация данных**: Выбираем только расходные операции ('C') в период с 01.01.2019 по 30.06.2019

2. **Накопительная сумма**: Используем оконную функцию `SUM() OVER()` для подсчета накопительной суммы расходов по каждому клиенту, упорядоченную по дате

3. **Поиск точки достижения**: Находим первую дату, когда накопительная сумма превышает или равна кредитному потенциалу

4. **Подсчет дней**: Вычисляем количество дней от 01.01.2019 до найденной даты

5. **Обработка случаев без достижения**: Если клиент не достиг своего кредитного потенциала, возвращаем 200

### Ключевые особенности:

- Использование `DATEDIFF()` для подсчета дней
- `COALESCE()` для обработки случаев, когда клиент не достиг потенциала
- `LEFT JOIN` для включения всех клиентов, даже тех, кто не совершал транзакций
- Фильтрация по `LIKE '%снятие%'` для второй части задачи

### Структура запроса:

```sql
WITH cumulative_spending AS (
    -- Подсчет накопительной суммы расходов
),
days_to_reach AS (
    -- Поиск дня достижения потенциала
)
SELECT 
    -- Финальный результат с обработкой случая 200
```

## Результат

Запрос возвращает для каждого клиента:
- `client_dk` - идентификатор клиента
- `Crd_potential` - кредитный потенциал
- `days_to_reach_potential` - количество дней до достижения потенциала (или 200) 